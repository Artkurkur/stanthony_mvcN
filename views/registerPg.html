<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>SAA Reunite Registration</title>
  <link rel="stylesheet" href="css/registerPg.css" />
</head>

<body>
  <div class="container flipped">
    <!-- Left Panel -->
    <div class="left-panel">
      <div class="saa-logo"></div>
      <div class="greeting">
        <h2><span class="wave">ðŸ‘‹</span> Hey there, Anthonian!</h2>
        <div class="welcome-line">
          <hr><span>Welcome to SAAReunite</span>
          <hr>
        </div>
        <p>Your digital home to reconnect, relive the memories, and reunite with your fellow classmates.</p>
      </div>

      <div class="left-form-fields">
        <div class="input-group">
          <span class="icon">ðŸ‘¤</span>
          <input type="text" id="fname" name="fname" placeholder="First Name" required />
        </div>

        <div class="input-group">
          <span class="icon">ðŸ‘¤</span>
          <input type="text" id="lname" name="lname" placeholder="Last Name" required />
        </div>

        <div class="input-group">
          <span class="icon">ðŸ‘¤</span>
          <input type="text" id="username" name="username" placeholder="Username" required />
        </div>

        <div class="input-group">
          <span class="icon">ðŸ“ž</span>
          <input type="text" id="mobile_number" name="mobile_number" placeholder="Mobile Number" />
        </div>
      </div>
    </div>

    <!-- Right Panel -->
    <div class="right-panel">
      <form class="register-form" id="registerForm">
        <div class="input-group">
          <label class="dropdown-label">Batch / Graduation Year</label>
          <select id="batch_year" name="batch_year" required>
            <option value="">Select your batch (e.g., 2015, 2016, etc.)</option>
            <option value="1991">1960</option>
            <option value="1991">1961</option>
            <option value="1992">1962</option>
            <option value="1993">1963</option>
            <option value="1994">1964</option>
            <option value="1995">1965</option>
            <option value="1996">1966</option>
            <option value="1997">1967</option>
            <option value="1998">1968</option>
            <option value="1999">1969</option>
            <option value="1990">1970</option>
            <option value="1991">1971</option>
            <option value="1992">1972</option>
            <option value="1993">1973</option>
            <option value="1994">1974</option>
            <option value="1995">1975</option>
            <option value="1996">1976</option>
            <option value="1997">1977</option>
            <option value="1998">1978</option>
            <option value="1999">1979</option>
            <option value="1990">1980</option>
            <option value="1991">1981</option>
            <option value="1992">1982</option>
            <option value="1993">1983</option>
            <option value="1994">1984</option>
            <option value="1995">1985</option>
            <option value="1996">1986</option>
            <option value="1997">1987</option>
            <option value="1998">1988</option>
            <option value="1999">1989</option>
            <option value="1990">1990</option>
            <option value="1991">1991</option>
            <option value="1992">1992</option>
            <option value="1993">1993</option>
            <option value="1994">1994</option>
            <option value="1995">1995</option>
            <option value="1996">1996</option>
            <option value="1997">1997</option>
            <option value="1998">1998</option>
            <option value="1999">1999</option>
            <option value="2000">2000</option>
            <option value="2001">2001</option>
            <option value="2002">2002</option>
            <option value="2003">2003</option>
            <option value="2004">2004</option>
            <option value="2005">2005</option>
            <option value="2006">2006</option>
            <option value="2007">2007</option>
            <option value="2008">2008</option>
            <option value="2009">2009</option>
            <option value="2010">2010</option>
            <option value="2011">2011</option>
            <option value="2012">2012</option>
            <option value="2013">2013</option>
            <option value="2014">2014</option>
            <option value="2015">2015</option>
            <option value="2016">2016</option>
            <option value="2017">2017</option>
            <option value="2018">2018</option>
            <option value="2019">2019</option>
            <option value="2020">2020</option>
            <option value="2021">2021</option>
            <option value="2022">2022</option>
            <option value="2023">2023</option>
            <option value="2024">2024</option>
            <option value="2025">2025</option>
            <option value="2026">2026</option>
          </select>
        </div>

        <div class="input-group">
          <span class="icon">ðŸ”’</span>
          <input type="password" id="password" name="password" placeholder="Create Password" required />
          <span class="toggle" onclick="togglePassword('password')"></span>
        </div>

        <div class="input-group">
          <span class="icon">ðŸ”’</span>
          <input type="password" id="confirm_password" name="confirm_password" placeholder="Confirm Password"
            required />
          <span class="toggle" onclick="togglePassword('confirm_password')"></span>
        </div>

        <div id="error-message"
          style="color: #dc3545; margin-bottom: 10px; display: none; padding: 10px; background-color: #f8d7da; border-radius: 5px; font-size: 14px;">
        </div>
        <div id="success-message"
          style="color: #28a745; margin-bottom: 10px; display: none; padding: 10px; background-color: #d4edda; border-radius: 5px; font-size: 14px;">
        </div>

        <button type="submit" class="register-btn">Register Account</button>
      </form>

      <div style="text-align: center; margin-top: 20px;">
        <p>Already have an account? <a href="login.html" style="color: #007bff; text-decoration: none;">Login here</a>
        </p>
      </div>
    </div>
  </div>

  <script>
    // Toggle password visibility
    function togglePassword(fieldId) {
      const field = document.getElementById(fieldId);
      const toggle = field.nextElementSibling;

      if (field.type === "password") {
        field.type = "text";
        toggle.textContent = "hide password";
      } else {
        field.type = "password";
        toggle.textContent = "show password";
      }
    }

    // Handle form submission
    document.getElementById("registerForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const errorMsg = document.getElementById("error-message");
      const successMsg = document.getElementById("success-message");
      errorMsg.style.display = "none";
      successMsg.style.display = "none";

      // Collect all form data - CHANGED: email to username
      const formData = {
        fname: document.getElementById("fname").value.trim(),
        lname: document.getElementById("lname").value.trim(),
        username: document.getElementById("username").value.trim(), // FIXED
        mobile_number: document.getElementById("mobile_number").value.trim(),
        batch_year: document.getElementById("batch_year").value,
        password: document.getElementById("password").value,
        confirm_password: document.getElementById("confirm_password").value
      };

      // Client-side validation - CHANGED: email to username
      if (!formData.fname || !formData.lname || !formData.username || !formData.batch_year || !formData.password) {
        errorMsg.textContent = "Please fill in all required fields!";
        errorMsg.style.display = "block";
        return;
      }

      if (formData.password !== formData.confirm_password) {
        errorMsg.textContent = "Passwords do not match!";
        errorMsg.style.display = "block";
        return;
      }

      if (formData.password.length < 8) {
        errorMsg.textContent = "Password must be at least 8 characters long!";
        errorMsg.style.display = "block";
        return;
      }

      // Disable submit button
      const submitBtn = document.querySelector(".register-btn");
      submitBtn.disabled = true;
      submitBtn.textContent = "Registering...";

      try {
        // Send registration request
        const response = await fetch("http://localhost:8000/api/register", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (response.ok) {
          successMsg.textContent = data.message || "Registration successful!";
          successMsg.style.display = "block";

          // Clear form
          document.getElementById("registerForm").reset();
          document.getElementById("fname").value = "";
          document.getElementById("lname").value = "";
          document.getElementById("username").value = ""; // FIXED
          document.getElementById("mobile_number").value = "";

          // Redirect to login after 2 seconds
          setTimeout(() => {
            window.location.href = "login.html";
          }, 2000);
        } else {
          errorMsg.textContent = data.message || "Registration failed. Please try again.";
          errorMsg.style.display = "block";
        }
      } catch (error) {
        errorMsg.textContent = "Network error. Please check your connection and try again.";
        errorMsg.style.display = "block";
        console.error("Registration error:", error);
      } finally {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.textContent = "Register Account";
      }
    });
  </script>
</body>

</html>